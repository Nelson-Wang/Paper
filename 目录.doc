产品名称Product name
密级Confidentiality level
FirberStart	内部公开
产品版本Product version	Total 103 pages 共 103 页

	

接入芯片技术白皮书（XPON）
(仅供内部使用）






拟制:
Prepared by	肖宁、李红波、焦玉军、杨春潮、罗繁		日期：
Date	2018-07-18
审核:
Reviewed by			日期：
Date	yyyy-mm-dd
批准:
Granted by			日期：
Date	yyyy-mm-dd

                                           

 

华为技术有限公司
Huawei Technologies Co.， Ltd.
版权所有  侵权必究
All rights reserved
修订记录Revision record
日期	修订版本	描述	作者
2018-7-18	1.0	整合PON领域技术白皮书，刷新NGPON DBA技术白皮书	李红波 00256603
			
			

目  录Table of Contents
1	NGPON DBA	19
1.1	DBA技术概述	19
1.1.1	什么是DBA	19
1.1.2	3个概念	19
1.2	DBA特性在协议的具体实现	21
1.2.1	DBA的报告机制简述	21
1.2.2	SR(Status Reporting)	21
1.2.3	NSR (Non Status Reporting)	21
1.2.4	DBA在GTC字段的实现	21
1.2.4.1	带宽下发	21
1.2.4.2	带宽上报	22
1.2.5	DBA在XGTC字段的实现	23
1.2.6	五种协议带宽类型	25
1.2.6.1	4种带宽成分	25
1.2.6.2	5种DBA带宽类型	25
1.3	DBA产品化分层实现	26
1.3.1	概述	26
1.3.2	总体流程简介	26
1.3.3	两类DBA配置参数划分	27
1.4	DBA用户界面	28
1.4.1	带宽类型和大小的配置	28
1.4.1.1	操作命令行	28
1.4.1.2	原理介绍	29
1.4.2	两种全局带宽模式配置 GPON/ETH	29
1.4.2.1	操作命令行：	29
1.4.2.2	原理介绍：	30
1.4.3	两种性能效果模式配置 最小时延/最大带宽利用率	30
1.4.3.1	操作命令行	30
1.4.3.2	原理介绍	32
1.4.3.3	两种性能模式的具体配置值	34
1.4.4	单板驱动层索引逻辑DBA表项	35
1.4.4.1	原理	35
1.4.4.2	测试关注	39
1.4.5	GMAC逻辑DBA功能	39
1.4.5.1	模块简介	39
1.4.5.2	DSP算法实现流程	40
1.4.6	剩余带宽的计算方法	45
1.5	DBA算法实现	45
1.5.1	DBA逻辑框架	45
1.5.2	DBA总体实现流程	46
1.5.3	fix+ab分配	48
1.5.3.1	fix+ab分配总体思路	48
1.5.3.2	fix+ab分配流程	50
1.5.3.3	fix+ab分配详细实现	51
1.5.4	Type2累积分配	66
1.5.4.1	Type2累积分配总体思路	66
1.5.4.2	Type2累积分配总体思路	67
1.5.5	nab分配	69
1.5.5.1	nab分配整体思路	69
1.5.5.2	nab分配流程	70
1.5.5.3	nab分配详细实现	71
1.5.6	be分配	73
1.5.6.1	be分配整体思路	73
1.5.6.2	be分配流程	74
1.5.6.3	be分配详细实现	75
1.5.7	单多帧自适应和回收分配	76
1.5.7.1	整体思路	76
1.5.7.2	分配流程	77
1.5.8	FEC回收分配	78
1.5.8.1	整体思路	78
1.5.8.2	处理流程	78
1.5.8.3	算法详解	78
1.5.9	带宽预分配	78
1.5.9.1	整体思路	78
1.5.9.2	处理流程	78
1.5.9.3	算法详解	78
1.6	测试指导	78
1.6.1	测试设计	78
1.6.2	测试指导	78
1.6.2.1	芯片DBA测试通用的观察手段	79
1.6.2.2	场景效果验证	79
1.6.2.3	带宽精度和粒度测试	80
1.6.2.4	带宽分配优先级	81
1.6.2.5	吞吐量验证	82
1.6.2.6	时延验证	83
1.6.2.7	协议功能点验证	84
1.6.2.8	支持DBRu Mode配置	84
1.6.2.9	NAB的多种权重分配效果验证	86
1.6.2.10	BE的多种权重分配效果验证	87
1.6.2.11	支持GAP值修改	88
1.6.2.12	支持DBRu_BLOCK大小修改	89
1.6.2.13	PLOAM 预留	90
1.6.2.14	算法功能点验证	93
1.6.2.15	支持按照ETH速率进行带宽分配	93
1.6.2.16	预分配功能	94
1.6.2.17	单多帧自适应	97
1.6.2.18	最小带宽	98
1.6.2.19	TYPE2 带宽累积	100
1.6.2.20	N轮分配	101
1.6.2.21	FEC回收	102
1.6.2.22	DFX功能	103
1.6.2.23	DSP版本查询和加载功能	103
1.6.2.24	周期为单位的带宽捕获功能	104
1.6.2.25	S为单位的带宽查询功能	104
1.6.2.26	最大可用带宽查询以及配置功能	104
1.6.2.27	剩余带宽实时查询	105
1.6.2.28	基于TCONT的实时速率查询	106
1.6.2.29	支持FIX带宽在固定时隙进行分配	106
1.7	GPON同XGPON的差异	106
1.8	DBA特性的挑战	107
1.8.1	理论存在的经典问题	107
1.8.2	测试模型单一的问题	107
1.8.3	测试标准问题	108
1.9	DBA带宽流量计算公式	108
2	XEPON DBA	108
2.1	DBA概述	108
2.1.1	DBA功能简介	108
2.1.2	EPON DBA带宽类型介绍	109
2.1.3	MPCP消息介绍	109
2.1.4	DBA交互过程介绍	111
2.2	DBA算法实现	112
2.2.1	EPON DBA计算处理流程	112
2.2.2	EPON DBA计算单点功能介绍	114
2.2.2.1	开销处理	114
2.2.2.2	流量预估（Report处理）	115
2.2.2.3	卡MTU	115
2.2.2.4	卡平均包长	116
2.2.2.5	卡FEC（10G-EPON涉及）	117
2.2.2.6	带宽处理	117
2.2.3	DBA交织过程介绍	122
2.3	DBA逻辑功能模块	123
2.3.1	DBA 逻辑功能概述	123
2.3.2	DBA 逻辑模块介绍	123
2.4	10G-EPON和1G-EPON DBA差异	124
2.5	DBA 其他功能介绍	125
2.5.1	带宽补偿	125
2.5.2	10G-EPON IPG调整	126
2.5.3	DBA告警	127
2.6	测试指导	127
2.6.1	测试设计	127
2.6.2	测试指导	127
2.7	性能模型专项分析	127
3	GPON/NGPON	128
3.1	引言	128
3.1.1	xGPON 规格对比	129
3.1.2	xGPON 传输汇聚层简介	129
3.1.3	XGTC 子层功能简介	132
3.1.4	xGPON 系统管理	133
3.2	xGPON 各子层详细介绍	133
3.2.1	业务适配子层（XGEM）	133
3.2.1.1	XGTC净荷结构	133
3.2.1.2	XGEM帧头	134
3.2.1.3	XGEM 净荷格式	135
3.2.1.4	空闲 XGEM 帧	135
3.2.1.5	XGEM帧定界	136
3.2.1.6	SDU 分片	137
3.2.1.7	Ethernet帧映射到XGEM帧	139
3.2.2	成帧子层	140
3.2.2.1	下行XGTC 成帧	141
3.2.2.2	XGTC帧头帧尾	141
3.2.2.3	BWmap 带宽映射分区	143
3.2.2.4	BWmap的构建限制	148
3.2.2.5	BWmap解析异常处理	149
3.2.2.6	上行XGTC成帧	149
3.2.3	PHY适配子层	153
3.2.3.1	下行物理帧	153
3.2.3.2	下行物理同步控制块（PSBd/PCBd）	153
3.2.3.3	ONU下行同步	155
3.2.3.4	上行物理帧和上行物理突发	157
3.2.3.5	上行物理同步块（PSBu/PLOu）	158
3.2.3.6	前向纠错（Forward Error Correction）	159
3.2.3.7	扰码	163
3.3	XG-PON和GPON协议对比	164
3.3.1	XG-PON和GPON的物理层要求对比	164
3.3.2	XG-PON和GPON GTC层对比	166
3.3.2.1	下行帧格式对比	166
3.3.2.2	上行帧格式对比	170
3.3.2.3	XGEM和GEM帧结构对比	172
3.3.3	XG-PON和GPON PLOAM消息对比	173
3.3.3.1	PLOAM结构对比	173
3.3.3.2	下行PLOAM对比	173
3.3.3.3	上行PLOAM对比	174
3.3.4	XG-PON和GPON OMCI消息对比	175
3.3.5	XG-PON和GPON安全特性对比	176
3.3.6	XG-PON和GPON线路告警对比	176
3.3.6.1	OLT端告警对比	176
3.3.6.2	ONU端告警对比	177
3.3.7	XG-PON和GPON激活过程对比	178
3.3.7.1	ONU状态对比	178
3.3.7.2	ONU激活事件对比	179
3.3.7.3	ONU状态变迁图对比	180
3.3.8	XG-PON和GPON Typeb保护倒换对比	183
3.4	XG-PON安全管理介绍	183
3.4.1	安全威胁模型	183
3.4.2	认证方式	184
1.1.1	Registration ID认证	184
3.4.3	密钥生成	184
3.4.3.1	加密方法	184
3.4.3.2	根密钥生成	184
3.4.3.3	共享密钥生成	185
3.4.4	XGEM 载荷加密系统	185
3.4.4.1	加密方法	185
3.4.4.2	初始计数模块	185
3.4.5	数据加密密钥交换和激活机制	187
3.4.5.1	单播加密	187
3.4.5.2	组播加密	191
3.4.6	PLOAM完整性保护和数据源鉴别	191
3.4.6.1	加密方法	191
3.4.6.2	MIC计算	191
3.4.7	OMCI完整性保护和数据源鉴别	191
3.4.8	密钥交换的完整性保护和数据源鉴别	192
3.4.9	键长小于128bit的XG-PON加密体系	192
3.5	XGPON概述	193
3.5.1	XGPON应用场景	193
3.5.2	XGMAC接口所处的位置	193
3.6	XGPON测试环境和测试组网图	194
3.6.1	硬件配置	194
3.6.2	软件版本	194
3.6.3	测试组网图	196
3.6.4	命令行访问说明	197
3.6.4.1	主控板串口进入通明通道和退出方法	198
3.6.4.2	XGBC单板串口访问界面	198
3.6.4.3	主控板访问界面	198
3.6.4.4	ONT访问界面	199
3.7	芯片 XGPON特性测试方法	199
3.7.1	ONT注册上线	199
3.7.1.1	ONT注册上线测试	199
3.7.1.2	下行异常报文冲击	199
3.7.1.3	前导码和定界符测试	200
3.7.2	AES	201
3.7.2.1	下行单播XGEM Port解密测试	201
3.7.2.2	下行组播XGEM Port解密测试	201
3.7.2.3	下行单播OMCI解密	203
3.7.2.4	下行组播OMCI解密	203
3.7.2.5	密钥切换测试	204
3.7.2.6	上行单播XGEM Port、OMCI加密测试	204
3.7.2.7	加密模式测试	205
3.7.3	FEC	205
3.7.3.1	下行FEC纠错能力测试	205
3.7.3.2	下行FEC统计测试	206
3.7.3.3	下行FEC Second测试	207
3.7.3.4	上行FEC插错测试？	207
3.7.3.5	上行FEC和Burst Profile ID切换统计测试	208
3.7.4	XGEM	208
3.7.4.1	本地增删XGEM Port测试	208
3.7.4.2	下行ETH切片测试	209
3.7.4.3	上行切片测试	210
3.7.5	OMCI	210
3.7.5.1	OMCI MIC校验测试	210
3.7.5.2	变长OMCI接收测试	211
3.7.5.3	变长OMCI发送测试	211
3.7.5.4	接收OMCI缓存溢出测试	211
3.7.5.5	CPU将OMCI报文切片发送测试	212
3.7.5.6	软件做OMCI MIC加速测试	212
3.7.5.7	动态刷新OMCI Ready指示测试?	212
3.7.6	PLOAM	213
3.7.6.1	PLOAM MIC校验测试	213
3.7.6.2	接收广播ONU-ID的PLOAM消息测试	213
3.7.6.3	过滤指定的MSG-ID的PLOAM消息测试	213
3.7.6.4	PLOAM接收缓存复位测试	214
3.7.6.5	XGMAC处理Ranging_Time PLOAM消息测试	214
3.7.6.6	PLOAM接收缓存满丢弃测试	215
3.7.6.7	软件进行PLOAM MIC校验测试	215
3.7.7	诊断运维	215
3.7.7.1	PON-ID信息同步测试	215
3.7.7.2	上行加扰不加扰测试	216
3.7.7.3	下行加扰不加扰测试	217
3.7.7.4	抓包功能测试	218
3.7.7.5	下行接收FCS错误报文丢弃控制测试	219
3.7.7.6	光模块使能状态模式测试	219
3.7.7.7	上行XGTC帧DG域强制置1测试	219
3.7.7.8	上行插错测试	220
3.7.7.9	CPU构造发送切片交织XGEM帧测试	221
3.7.7.10	TCONT 1S累计带宽授权和发送Idle帧字节统计	222
4	EPON/10G EPON	222
4.1	10G-EPON概述	222
4.1.1	10G-EPON功能简介	222
4.1.2	10G-EPON的报文格式	223
4.1.3	MPCP注册过程的差异	225
4.2	10G-EPON各层次功能描述	228
4.2.1	10G-EPON协议栈结构	228
4.2.2	MAC模块介绍	230
4.2.3	RS层功能介绍	232
4.2.4	PCS层功能介绍	235
4.2.4.1	IDLE_DEL：4字节IDLE码的删除	236
4.2.4.2	DEC_64B	236
4.2.4.3	Scrambler 扰码	237
4.2.4.4	FEC	237
4.2.4.5	接收同步	239
4.3	10G-EPON测试难点分析	239
4.3.1	IPG原理	239
4.3.2	FEC上行跟随功能	240
4.3.3	Flush功能	241
4.3.4	DBA混合组网	241
4.3.5	RTT补偿和测距	242
4.3.6	Report测试	243
4.4	特性测试指导	243
4.4.1	初始化	243
4.4.2	FEC插错	243
4.4.3	MTU	247
4.4.4	Mode域	247
4.4.5	Oam发送	248
4.4.6	Oam匹配	250
4.4.7	握手oam	250
4.4.8	接收到LLID的非握手OAM消息刷新握手OAM超时检测时间测试	255
4.4.9	UDAF复位	256
4.4.10	PON serdes 复位	257
4.4.11	PONserdes 环回	258
4.4.12	测试接收太长太短报文、frag、jab统计	259
4.4.13	BD	266
4.4.14	触发满规格LLID MPCP /OAM超时	267
4.4.15	PCS环回	268
4.4.16	上行接收是否剥离FCS	269
4.4.17	RTT漂移	272
5	XPON节能	274
5.1	特性介绍	274
5.2	特性结构分析	276
5.3	XPON节能协议分析	276
5.3.1	XGPON节能协议分析	276
5.3.1.1	控制面实现分析	277
5.3.1.2	协议状态机分析	277
5.3.2	XEPON节能协议分析	282
5.3.2.1	控制面实现分析	283
5.3.2.2	协议状态机分析	285
5.4	芯片实现	289
5.4.1	逻辑框架和总体流程	289
5.4.2	节能状态机实现	290
5.5	测试验证方案	293
5.5.1	节能交付内容分析	293
5.5.2	验证方案总体思路	293
5.6	测试设计分析	295
5.6.1	ONT进入节能	295
5.6.2	ONT退出节能	295
5.6.3	ONT掉线检测	296
5.6.4	ONT掉线检测	296
5.6.5	维护诊断	297
5.7	测试指导	297
5.7.1	测试配置指导	297
5.7.1.1	下发SA(ON)/最大刷新时间配置	298
5.7.1.2	ONT节能相关时间参数配置	298
5.7.1.3	配置ONT进入/退出低功耗	299
5.7.1.4	OLT唤醒方式配置	300
5.7.1.5	BWMAP唤醒指示Bit位置配置	300
5.7.1.6	SA(OFF)消息模板配置、查询	300
5.7.1.7	SR(awake/doze/sleep)消息模板配置	301
5.7.1.8	OLT唤醒ONT配置	301
5.7.1.9	配置ONT配置状态为Doze/Sleep/Nromal	301
5.7.1.10	配置SR消息逻辑处理策略	302
5.7.1.11	配置SR交CPU处理策略	302
5.7.1.12	配置SA(OFF)唤醒消息发送次数	302
5.7.1.13	配置SA(OFF)唤醒消息发送周期间隔	302
5.7.1.14	配置、查询、清除指定ONUID的轨迹跟踪	303
5.7.1.15	查询ONT的工作状态和当前状态	303
5.7.1.16	查询OLT发送SA统计计数	304
5.7.1.17	查询OLT接收SR统计计数	304
5.7.1.18	查询/清除ONUID节能状态变化次数	304
5.7.1.19	监控指定ONUID在Aware/Sleep驻留时间	305
5.7.1.20	NP触发唤醒发送唤醒消息个数查询/清除	305
5.7.1.21	定时器异常超时统计	305
5.7.1.22	NP收到MAC发送状态同步消息统计查询/清除	306
5.7.1.23	NP检测流量触发唤醒相关配置	306
5.7.1.24	OLT控制ONT进入/退出节能状态Debug功能	306
5.7.1.25	控制ONT进入周期性节能基本命令行汇总	306
5.7.2	测试难点方法指导	307
5.7.2.1	低功耗状态仅给TCONT0分配基本带宽	307
5.7.2.2	Doze/Sleep掉线检测超时	307
5.7.2.3	Doze/Sleep假睡眠检测超时	307
5.7.2.4	NP检测流量唤醒Sleep ONT	307
5.8	问题定位指南	308
5.8.1	节能故障树分析	308
5.8.2	典型问题定位指南	309
5.8.2.1	ONT进入低功耗失败	309
5.8.2.2	ONT进入低功耗又立即退出	309
5.8.2.3	上报LOS造成低功耗ONT掉线	310
5.8.2.4	握手MPCP超时掉线	310
5.8.2.5	握手OAM超时掉线	310
5.8.2.6	Sleep ONT出现LOAMi	310
5.8.2.7	Sleep ONT出现配置失败	311
5.8.2.8	NP唤醒Sleep ONT失败	311
5.8.2.9	CPU唤醒ONT失败	311
6	XPON ODN	312
6.1	概述	312
6.2	特性结构分析	312
6.3	ODN应用场景	313
6.3.1	流氓ONT检测	313
6.3.2	二次反射检测	313
6.3.3	RSSI测量	314
6.3.4	OTDR测量	315
6.4	芯片实现	316
6.4.1	流氓ONT检测	316
6.4.1.1	开窗检测流氓	316
6.4.1.2	剩余带宽检测流氓	317
6.4.2	二次反射检测	317
6.4.2.1	Ranging开窗检测反射	318
6.4.2.2	开窗检测反射	318
6.4.2.3	剩余带宽检测反射	318
6.4.3	RSSI测量	318
6.4.4	OTDR测量	320
6.4.4.1	OLT OTDR测量	320
6.4.4.2	ONT OTDR测量	321
6.5	测试设计分析	322
6.5.1	流氓ONT检测	322
6.5.2	二次反射检测	323
6.5.3	RSSI测量	323
6.5.4	OTDR测量	324
6.6	测试指导	324
6.6.1	测试配置指导	324
6.6.1.1	流氓/反射检测定界符配置/查询	324
6.6.1.2	流氓ONT检测内容配置	325
6.6.1.3	开窗检流氓ONT参数配置/查询	325
6.6.1.4	启动开窗检测流氓ONT配置	326
6.6.1.5	查询开窗检测流氓ONT的结果	326
6.6.1.6	剩余带宽检测参数配置	326
6.6.1.7	使能剩余带宽检测配置	327
6.6.1.8	使能自适应检测未上线流氓ONT	327
6.6.1.9	查询自适应检测未上线流氓ONT的结果	327
6.6.1.10	查询剩余带宽检测的结果	328
6.6.1.11	反射检测内容配置	328
6.6.1.12	使能Ranging开窗检测反射	328
6.6.1.13	查询Ranging开窗检测反射的结果	329
6.6.1.14	开窗检测反射参数配置/查询	329
6.6.1.15	启动开窗检测反射	330
6.6.1.16	查询开窗检测反射结果	330
6.6.1.17	清除流氓/反射检测的结果数据	330
6.6.1.18	RSSI参数配置/查询	330
6.6.1.19	RSSI使能配置	332
6.6.1.20	OLT OTDR使能配置	332
6.6.1.21	ONT OTDR使能配置	333
6.6.1.22	ODN中断使能配置	334
6.6.2	测试方法指导	334
6.6.2.1	GPON/XG-PON流氓ONT构造方法	334
6.6.2.2	XEPON流氓ONT构造方法	335
6.6.2.3	反射ONT构造方法	335
6.6.2.4	ONT反射数据落在任意位置构造方法	336
6.6.2.5	OTDR是否开窗确认方法	337
6.6.3	常见问题定位指南	337
6.6.3.1	剩余带宽检流氓ONT失败	337
6.6.3.2	剩余带宽检测反射失败	338
6.6.3.3	RSSI测量光功率失败或者不准	338
6.6.3.4	流氓/反射检测结果信息错误	338
7	XPON TypeB	339
7.1	概述	339
7.1.1	特性功能介绍	339
7.1.2	单归和双归	339
7.1.3	产生倒换的场景	340
7.2	特性结构分析	340
7.3	芯片实现	340
7.3.1	XG-PON TypeB	340
7.3.2	XG-PON TypeB	340
7.3.2.1	芯片自动倒换	341
7.3.2.2	软件配合倒换	341
7.3.3	NG EPON TypeB	342
7.3.3.1	芯片自动倒换	343
7.3.3.2	软件配合倒换	343
7.3.3.3	备口实时测距	344
7.4	测试设计分析	344
7.5	关键技术分析	345
7.5.1	倒换时延	345
7.5.2	倒换成功率	345
